# üåç ÌôòÍ≤Ω Í¥ÄÎ¶¨

> Korea Public Data ÌîÑÎ°úÏ†ùÌä∏Ïùò Îã§Ï§ë ÌôòÍ≤Ω Íµ¨ÏÑ± Î∞è Í¥ÄÎ¶¨ Ï†ÑÎûµ

## üìã Î™©Ï∞®
- [ÌôòÍ≤Ω Íµ¨ÏÑ± Í∞úÏöî](#ÌôòÍ≤Ω-Íµ¨ÏÑ±-Í∞úÏöî)
- [ÌôòÍ≤ΩÎ≥Ñ ÏÉÅÏÑ∏ Íµ¨ÏÑ±](#ÌôòÍ≤ΩÎ≥Ñ-ÏÉÅÏÑ∏-Íµ¨ÏÑ±)
- [ÏÑ§Ï†ï ÌååÏùº Í¥ÄÎ¶¨](#ÏÑ§Ï†ï-ÌååÏùº-Í¥ÄÎ¶¨)
- [Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Í¥ÄÎ¶¨](#Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§-Í¥ÄÎ¶¨)
- [Î≥¥Ïïà Î∞è ÏãúÌÅ¨Î¶ø Í¥ÄÎ¶¨](#Î≥¥Ïïà-Î∞è-ÏãúÌÅ¨Î¶ø-Í¥ÄÎ¶¨)
- [ÌôòÍ≤Ω Í∞Ñ Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞Ìôî](#ÌôòÍ≤Ω-Í∞Ñ-Îç∞Ïù¥ÌÑ∞-ÎèôÍ∏∞Ìôî)
- [Î™®ÎãàÌÑ∞ÎßÅ Î∞è Î°úÍπÖ](#Î™®ÎãàÌÑ∞ÎßÅ-Î∞è-Î°úÍπÖ)

## üèó ÌôòÍ≤Ω Íµ¨ÏÑ± Í∞úÏöî

### ÌôòÍ≤Ω ÏïÑÌÇ§ÌÖçÏ≤ò
```mermaid
graph TD
    A[Developer Local] --> B[Development]
    B --> C[Staging]
    C --> D[Production]
    
    B --> E[(Dev DB)]
    C --> F[(Stage DB)]
    D --> G[(Prod DB)]
    
    H[CI/CD Pipeline] --> B
    H --> C
    H --> D
```

### ÌôòÍ≤Ω Îß§Ìä∏Î¶≠Ïä§
| ÌôòÍ≤Ω | Î™©Ï†Å | Î∏åÎûúÏπò | Î∞∞Ìè¨ Î∞©Ïãù | Îç∞Ïù¥ÌÑ∞ |
|------|------|--------|-----------|--------|
| **Local** | Í∞úÎ∞úÏûê Î°úÏª¨ Í∞úÎ∞ú | feature/* | Manual | Mock/Seed |
| **Development** | Í∞úÎ∞ú ÌÜµÌï© ÌÖåÏä§Ìä∏ | develop | Auto (CI) | Test Data |
| **Staging** | UAT/ÏÑ±Îä• ÌÖåÏä§Ìä∏ | staging | Auto (CI) | Production-like |
| **Production** | Ïã§Ï†ú ÏÑúÎπÑÏä§ | main | Manual Approval | Real Data |

## üöÄ ÌôòÍ≤ΩÎ≥Ñ ÏÉÅÏÑ∏ Íµ¨ÏÑ±

### Local Development
```yaml
# docker-compose.local.yml
version: '3.8'
services:
  frontend:
    build: ./fe
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=development
      - NEXT_PUBLIC_API_URL=http://localhost:8000
      - NEXT_PUBLIC_ENVIRONMENT=local
    volumes:
      - ./fe:/app
      - /app/node_modules

  backend:
    build: ./be
    ports:
      - "8000:8000"
    environment:
      - ENVIRONMENT=local
      - DEBUG=True
      - DATABASE_URL=mongodb://mongodb:27017/korea_public_api_local
      - REDIS_URL=redis://redis:6379/0
    volumes:
      - ./be:/app
    depends_on:
      - mongodb
      - redis

  mongodb:
    image: mongo:6.0
    ports:
      - "27017:27017"
    volumes:
      - mongo_local_data:/data/db
    environment:
      - MONGO_INITDB_ROOT_USERNAME=admin
      - MONGO_INITDB_ROOT_PASSWORD=password
      - MONGO_INITDB_DATABASE=korea_public_api_local

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_local_data:/data
```

### Development Environment
```yaml
# k8s/development/namespace.yml
apiVersion: v1
kind: Namespace
metadata:
  name: korea-dev
  labels:
    environment: development

---
# k8s/development/configmap.yml
apiVersion: v1
kind: ConfigMap
metadata:
  name: korea-config
  namespace: korea-dev
data:
  NODE_ENV: "development"
  API_URL: "https://api-dev.korea-public-data.com"
  DATABASE_NAME: "korea_public_api_dev"
  LOG_LEVEL: "DEBUG"
  RATE_LIMIT_REQUESTS: "1000"
  CACHE_TTL: "300"

---
# k8s/development/deployment.yml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: korea-frontend
  namespace: korea-dev
spec:
  replicas: 2
  selector:
    matchLabels:
      app: korea-frontend
      environment: development
  template:
    metadata:
      labels:
        app: korea-frontend
        environment: development
    spec:
      containers:
        - name: frontend
          image: korea-fe:develop
          ports:
            - containerPort: 3000
          envFrom:
            - configMapRef:
                name: korea-config
            - secretRef:
                name: korea-secrets
          resources:
            requests:
              memory: "256Mi"
              cpu: "250m"
            limits:
              memory: "512Mi"
              cpu: "500m"
```

### Staging Environment
```yaml
# k8s/staging/deployment.yml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: korea-backend
  namespace: korea-staging
spec:
  replicas: 3
  selector:
    matchLabels:
      app: korea-backend
      environment: staging
  template:
    spec:
      containers:
        - name: backend
          image: korea-be:staging
          ports:
            - containerPort: 8000
          env:
            - name: ENVIRONMENT
              value: "staging"
            - name: DATABASE_URL
              valueFrom:
                secretKeyRef:
                  name: korea-secrets
                  key: database-url
          resources:
            requests:
              memory: "512Mi"
              cpu: "500m"
            limits:
              memory: "1Gi"
              cpu: "1000m"
          readinessProbe:
            httpGet:
              path: /health
              port: 8000
            initialDelaySeconds: 10
            periodSeconds: 5
          livenessProbe:
            httpGet:
              path: /health
              port: 8000
            initialDelaySeconds: 30
            periodSeconds: 10
```

### Production Environment
```yaml
# k8s/production/deployment.yml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: korea-backend
  namespace: korea-prod
spec:
  replicas: 5
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 1
      maxSurge: 1
  selector:
    matchLabels:
      app: korea-backend
      environment: production
  template:
    spec:
      containers:
        - name: backend
          image: korea-be:latest
          ports:
            - containerPort: 8000
          env:
            - name: ENVIRONMENT
              value: "production"
          resources:
            requests:
              memory: "1Gi"
              cpu: "1000m"
            limits:
              memory: "2Gi"
              cpu: "2000m"
          securityContext:
            readOnlyRootFilesystem: true
            runAsNonRoot: true
            runAsUser: 1000
```

## ‚öôÔ∏è ÏÑ§Ï†ï ÌååÏùº Í¥ÄÎ¶¨

### Frontend ÌôòÍ≤Ω ÏÑ§Ï†ï
```typescript
// fe/src/config/env.ts
const environments = {
  local: {
    apiUrl: 'http://localhost:8000',
    logLevel: 'debug',
    enableDevTools: true,
  },
  development: {
    apiUrl: 'https://api-dev.korea-public-data.com',
    logLevel: 'info',
    enableDevTools: true,
  },
  staging: {
    apiUrl: 'https://api-staging.korea-public-data.com',
    logLevel: 'warn',
    enableDevTools: false,
  },
  production: {
    apiUrl: 'https://api.korea-public-data.com',
    logLevel: 'error',
    enableDevTools: false,
  },
};

export const config = environments[process.env.NEXT_PUBLIC_ENVIRONMENT || 'local'];
```

### Backend ÌôòÍ≤Ω ÏÑ§Ï†ï
```python
# be/app/core/config.py
import os
from typing import Literal
from pydantic_settings import BaseSettings

EnvironmentType = Literal['local', 'development', 'staging', 'production']

class Settings(BaseSettings):
    environment: EnvironmentType = 'local'
    debug: bool = False
    
    # Database
    database_url: str
    database_name: str = 'korea_public_api'
    
    # Redis
    redis_url: str = 'redis://localhost:6379/0'
    
    # API Keys
    public_data_api_key: str
    google_oauth_client_id: str
    
    # Security
    secret_key: str
    jwt_expiry_minutes: int = 30
    
    # Rate Limiting
    rate_limit_requests: int = 100
    rate_limit_window: int = 60
    
    # Logging
    log_level: str = 'INFO'
    
    # External APIs
    kstartup_api_url: str = 'https://api.k-startup.go.kr'
    
    class Config:
        env_file = f".env.{os.getenv('ENVIRONMENT', 'local')}"

# Environment-specific configurations
class LocalSettings(Settings):
    debug: bool = True
    log_level: str = 'DEBUG'

class DevelopmentSettings(Settings):
    debug: bool = True
    log_level: str = 'DEBUG'

class StagingSettings(Settings):
    debug: bool = False
    log_level: str = 'INFO'

class ProductionSettings(Settings):
    debug: bool = False
    log_level: str = 'WARNING'
    
    # Production-specific security settings
    jwt_expiry_minutes: int = 15
    rate_limit_requests: int = 50

def get_settings() -> Settings:
    env = os.getenv('ENVIRONMENT', 'local')
    settings_map = {
        'local': LocalSettings,
        'development': DevelopmentSettings, 
        'staging': StagingSettings,
        'production': ProductionSettings,
    }
    return settings_map[env]()

settings = get_settings()
```

## üóÑÔ∏è Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Í¥ÄÎ¶¨

### ÌôòÍ≤ΩÎ≥Ñ Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Íµ¨ÏÑ±
```yaml
# Database Configuration Matrix
environments:
  local:
    type: "MongoDB"
    host: "localhost"
    port: 27017
    database: "korea_public_api_local"
    username: "admin"
    replica_set: false
    
  development:
    type: "MongoDB Atlas"
    connection_string: "${DEV_DATABASE_URL}"
    database: "korea_public_api_dev"
    replica_set: true
    read_preference: "primaryPreferred"
    
  staging:
    type: "MongoDB Atlas"
    connection_string: "${STAGING_DATABASE_URL}"
    database: "korea_public_api_staging"
    replica_set: true
    read_preference: "secondary"
    
  production:
    type: "MongoDB Atlas"
    connection_string: "${PROD_DATABASE_URL}"
    database: "korea_public_api_prod"
    replica_set: true
    read_preference: "primary"
    backup_enabled: true
    point_in_time_recovery: true
```

### ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Í¥ÄÎ¶¨
```python
# be/scripts/migrate.py
import asyncio
import os
from motor.motor_asyncio import AsyncIOMotorClient
from app.core.config import settings

async def run_migration(environment: str, migration_name: str):
    """Run database migration for specific environment"""
    
    client = AsyncIOMotorClient(settings.database_url)
    db = client[settings.database_name]
    
    # Check migration history
    migrations = db.migrations
    existing = await migrations.find_one({"name": migration_name})
    
    if existing:
        print(f"Migration {migration_name} already applied")
        return
    
    # Apply migration based on environment
    if environment == "local":
        await apply_local_migration(db, migration_name)
    elif environment == "development":
        await apply_dev_migration(db, migration_name)
    elif environment in ["staging", "production"]:
        await apply_prod_migration(db, migration_name)
    
    # Record migration
    await migrations.insert_one({
        "name": migration_name,
        "applied_at": datetime.utcnow(),
        "environment": environment
    })
    
    print(f"Migration {migration_name} applied successfully")
```

## üîê Î≥¥Ïïà Î∞è ÏãúÌÅ¨Î¶ø Í¥ÄÎ¶¨

### Kubernetes Secrets
```yaml
# k8s/base/secrets.yml
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: vault-backend
spec:
  provider:
    vault:
      server: "https://vault.company.com"
      path: "secret"
      version: "v2"
      auth:
        kubernetes:
          mountPath: "kubernetes"
          role: "korea-public-data"

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: korea-secrets
spec:
  refreshInterval: 15s
  secretStoreRef:
    name: vault-backend
    kind: SecretStore
  target:
    name: korea-secrets
    creationPolicy: Owner
  data:
    - secretKey: database-url
      remoteRef:
        key: korea-public-data
        property: database_url
    - secretKey: redis-url
      remoteRef:
        key: korea-public-data
        property: redis_url
```

### ÌôòÍ≤ΩÎ≥Ñ ÏãúÌÅ¨Î¶ø Î∂ÑÎ¶¨
```bash
# Development Secrets
kubectl create secret generic korea-secrets \
  --from-literal=database-url="mongodb://dev-cluster/korea_dev" \
  --from-literal=jwt-secret="dev-jwt-secret-key" \
  --from-literal=api-key="dev-api-key" \
  --namespace=korea-dev

# Production Secrets
kubectl create secret generic korea-secrets \
  --from-literal=database-url="mongodb://prod-cluster/korea_prod" \
  --from-literal=jwt-secret="$(openssl rand -base64 32)" \
  --from-literal=api-key="prod-api-key" \
  --namespace=korea-prod
```

## üîÑ ÌôòÍ≤Ω Í∞Ñ Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞Ìôî

### Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞Ìôî Ïä§ÌÅ¨Î¶ΩÌä∏
```python
# scripts/sync_data.py
import asyncio
from typing import Literal
from motor.motor_asyncio import AsyncIOMotorClient

EnvironmentType = Literal['dev', 'staging', 'prod']

async def sync_environments(
    source: EnvironmentType, 
    target: EnvironmentType,
    collections: list[str] = None
):
    """Sync data between environments"""
    
    # Connect to source and target
    source_client = AsyncIOMotorClient(get_db_url(source))
    target_client = AsyncIOMotorClient(get_db_url(target))
    
    source_db = source_client[f"korea_public_api_{source}"]
    target_db = target_client[f"korea_public_api_{target}"]
    
    collections = collections or ["announcements", "businesses", "users"]
    
    for collection_name in collections:
        print(f"Syncing {collection_name}...")
        
        # Clear target collection (if not production)
        if target != 'prod':
            await target_db[collection_name].delete_many({})
        
        # Copy data
        async for document in source_db[collection_name].find():
            # Remove _id to avoid conflicts
            document.pop('_id', None)
            
            # Anonymize sensitive data for non-production
            if target != 'prod':
                document = anonymize_document(document)
            
            await target_db[collection_name].insert_one(document)
        
        print(f"Synced {collection_name} successfully")

def anonymize_document(doc: dict) -> dict:
    """Remove or anonymize sensitive information"""
    if 'email' in doc:
        doc['email'] = f"test_{doc['email'].split('@')[0]}@example.com"
    if 'phone' in doc:
        doc['phone'] = "010-1234-5678"
    return doc
```

### ÌôòÍ≤Ω Ï†ÑÌôò Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏
```yaml
# Environment Switch Checklist
pre_switch:
  - name: "Database backup"
    command: "mongodump --uri=$SOURCE_DB_URL"
    required: true
    
  - name: "Configuration validation"
    command: "./scripts/validate-config.sh $TARGET_ENV"
    required: true
    
  - name: "Health check"
    command: "curl -f $TARGET_ENV_URL/health"
    required: true

post_switch:
  - name: "Smoke tests"
    command: "npm run test:smoke -- --env=$TARGET_ENV"
    required: true
    
  - name: "Performance check"
    command: "./scripts/performance-test.sh $TARGET_ENV"
    required: false
    
  - name: "Monitor alerts"
    command: "sleep 300 && ./scripts/check-alerts.sh"
    required: true
```

## üìä Î™®ÎãàÌÑ∞ÎßÅ Î∞è Î°úÍπÖ

### ÌôòÍ≤ΩÎ≥Ñ Î™®ÎãàÌÑ∞ÎßÅ ÏÑ§Ï†ï
```yaml
# monitoring/prometheus-rules.yml
groups:
  - name: environment-specific
    rules:
      # Development - Relaxed thresholds
      - alert: HighResponseTime-Dev
        expr: histogram_quantile(0.95, http_request_duration_seconds) > 2
        for: 5m
        labels:
          severity: warning
          environment: development
      
      # Production - Strict thresholds
      - alert: HighResponseTime-Prod
        expr: histogram_quantile(0.95, http_request_duration_seconds) > 0.5
        for: 1m
        labels:
          severity: critical
          environment: production
```

### Î°úÍ∑∏ ÏàòÏßë Î∞è Î∂ÑÏÑù
```yaml
# logging/fluent-bit-config.yml
apiVersion: v1
kind: ConfigMap
metadata:
  name: fluent-bit-config
data:
  fluent-bit.conf: |
    [INPUT]
        Name              tail
        Path              /var/log/containers/*korea*
        Parser            docker
        Tag               korea.*
        Refresh_Interval  5
    
    [FILTER]
        Name                kubernetes
        Match               korea.*
        Kube_URL            https://kubernetes.default.svc:443
        Kube_CA_File        /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
        Kube_Token_File     /var/run/secrets/kubernetes.io/serviceaccount/token
    
    [OUTPUT]
        Name  es
        Match *
        Host  elasticsearch.logging.svc.cluster.local
        Port  9200
        Index korea-logs-${ENVIRONMENT}
```

## üõ† ÌôòÍ≤Ω Í¥ÄÎ¶¨ ÎèÑÍµ¨

### ÌôòÍ≤Ω ÏÑ§Ï†ï Í≤ÄÏ¶ù Ïä§ÌÅ¨Î¶ΩÌä∏
```bash
#!/bin/bash
# scripts/validate-environment.sh

ENVIRONMENT=${1:-development}

echo "üîç Validating $ENVIRONMENT environment..."

# Check required environment variables
required_vars=(
    "DATABASE_URL"
    "REDIS_URL" 
    "PUBLIC_DATA_API_KEY"
    "JWT_SECRET"
)

for var in "${required_vars[@]}"; do
    if [ -z "${!var}" ]; then
        echo "‚ùå Missing required variable: $var"
        exit 1
    fi
done

# Validate database connection
echo "üìä Testing database connection..."
python -c "
import asyncio
from motor.motor_asyncio import AsyncIOMotorClient
async def test_db():
    client = AsyncIOMotorClient('$DATABASE_URL')
    await client.admin.command('ping')
    print('‚úÖ Database connection successful')
asyncio.run(test_db())
"

# Validate external APIs
echo "üåê Testing external API connections..."
curl -f "$KSTARTUP_API_URL/health" || echo "‚ö†Ô∏è K-Startup API connection failed"

echo "‚úÖ Environment validation completed"
```

## üìã ÌôòÍ≤Ω ÏÉÅÌÉú ÎåÄÏãúÎ≥¥Îìú

| ÌôòÍ≤Ω | ÏÉÅÌÉú | Î≤ÑÏ†Ñ | ÎßàÏßÄÎßâ Î∞∞Ìè¨ | CPU | Memory | ÏùëÎãµÏãúÍ∞Ñ |
|------|------|------|-------------|-----|---------|----------|
| Development | üü¢ Running | v1.2.0-dev | 2025-08-14 10:30 | 45% | 60% | 150ms |
| Staging | üü¢ Running | v1.1.5 | 2025-08-13 15:20 | 30% | 40% | 120ms |
| Production | üü¢ Running | v1.1.4 | 2025-08-12 09:00 | 25% | 35% | 80ms |

## üîÑ ÏóÖÎç∞Ïù¥Ìä∏ Ïù¥Î†•

| Î≤ÑÏ†Ñ | ÎÇ†Ïßú | Î≥ÄÍ≤ΩÏÇ¨Ìï≠ | ÏûëÏÑ±Ïûê |
|------|------|----------|--------|
| 1.0.0 | 2025-08-14 | Ï¥àÍ∏∞ ÌôòÍ≤Ω Í¥ÄÎ¶¨ Íµ¨Ï°∞ ÏàòÎ¶Ω | PM |

---

*Î≥∏ ÌôòÍ≤Ω Í¥ÄÎ¶¨ Î¨∏ÏÑúÎäî ÌîÑÎ°úÏ†ùÌä∏ Ïù∏ÌîÑÎùº Î≥ÄÍ≤ΩÏÇ¨Ìï≠Ïóê Îî∞Îùº ÏßÄÏÜçÏ†ÅÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏ÎêòÎ©∞, Î™®Îì† ÌôòÍ≤Ω Î≥ÄÍ≤ΩÏùÄ Ï†ïÏùòÎêú ÌîÑÎ°úÏÑ∏Ïä§Î•º Ï§ÄÏàòÌï¥Ïïº Ìï©ÎãàÎã§.*